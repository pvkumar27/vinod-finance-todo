# Run version validation if both version files are changed
if git diff --cached --name-only | grep -q "package.json" && \
   git diff --cached --name-only | grep -q "src/constants/version.js"; then
  echo "🔍 Validating version consistency..."
  node scripts/validate-versions.js
  if [ $? -ne 0 ]; then
    echo "❌ Version validation failed. Please fix the versions before committing."
    exit 1
  fi
fi

# ESLint auto-fix disabled - was causing parsing errors
# if git diff --cached --name-only | grep -E "\.(js|jsx)$" > /dev/null; then
#   echo "🔧 Auto-fixing ESLint warnings..."
#   node scripts/fix-eslint-warnings.js
# fi

# SonarQube auto-fix disabled - was slowing down commits
# if git diff --cached --name-only | grep -E "\.(js|jsx)$" > /dev/null; then
#   echo "🔧 Checking SonarQube issues..."
#   node scripts/pre-commit-sonar-check.js
# fi

# Run E2E tests if UI components changed (temporarily disabled)
# if git diff --cached --name-only | grep -E "src/components/.*\.(js|jsx)$" > /dev/null; then
#   echo "🧪 Running essential E2E tests..."
#   npm run test:e2e:essential
#   if [ $? -ne 0 ]; then
#     echo "❌ E2E tests failed. Please fix before committing."
#     exit 1
#   fi
# fi

npx lint-staged